@* vvv *@
@{
    ViewBag.Title = "Dashboard";
}


<ul class="nav nav-tabs" id="myTab" role="tablist">
    <li class="nav-item">
        <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">儀錶板</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">熱銷商品</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab" aria-controls="contact" aria-selected="false">當週銷售</a>
    </li>
    <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#contact" role="button" aria-haspopup="true" aria-expanded="false">銷售排行</a>
        <div class="dropdown-menu">
            <a class="dropdown-item" id="contact-tab" data-toggle="tab" href="#contact" role="tab" aria-controls="contact" aria-selected="false">當週銷售</a>
            <a class="dropdown-item" href="#">當月銷售</a>
            <a class="dropdown-item" href="#">Something else here</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="#">Separated link</a>
        </div>
    </li>
</ul>

<div class="tab-content" id="myTabContent">
    <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
        <div class="container" style="overflow-x:auto">
            <br />
            <iframe width="1140" height="541.25" src="https://app.powerbi.com/reportEmbed?reportId=74346742-eb4b-4219-b593-d4eccb23927f&autoAuth=true&ctid=fbf0cb04-6e6a-4334-9e1d-38fd37234fdb&config=eyJjbHVzdGVyVXJsIjoiaHR0cHM6Ly93YWJpLXNvdXRoLWVhc3QtYXNpYS1yZWRpcmVjdC5hbmFseXNpcy53aW5kb3dzLm5ldC8ifQ%3D%3D" frameborder="0" allowFullScreen="true"></iframe>
            <br />
            <br />
        </div>
    </div>

    <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
        <div class="d-flex p-2 ">
            請輸入查詢數量(內建為5) :<input id="topNumber" type="number" min="1" value="5" />
            <button class="btn btn-navbar" type="submit" onclick="topProduct()">
                <i class="fas fa-search"></i>
            </button>
            @*<a class="btn btn-outline-info" onclick="topProduct()">查詢</a>*@
        </div>
        <div class="d-flex p-2 justify-content-center">
            <div id="topProduct" style="width:100%; height:400px;"></div>
        </div>
    </div>

    <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
        <br />
        <div class="d-flex p-2 justify-content-center ">
            <div id="weekRevenue"></div>
        </div>
        <br />
    </div>

</div>






@section scripts{
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script>
        $(document).ready(function () {
            topProduct();
            weekRevenue();
        })

        //銷售數量最多的商品
        function topProduct()
        {
            let topNumber = $("#topNumber").val();

            $.ajax({
                type: 'GET',
                url: "../AdminLTE/getTopProductData?topNumber="+ topNumber,
                success: function (result) {
                    console.log(result);
                    var myChart = Highcharts.chart('topProduct', {
                        chart: {
                            type: 'column'
                        },
                        title: {
                            text: `Top ${topNumber}`
                        },
                        xAxis: {
                            type: 'category',
                            labels: {
                                style: {
                                    fontSize: '18px'
                                }
                            }
                        },
                        yAxis: {
                            min:0,
                            title: {
                                text: '數量',
                            },
                        },
                        legend: {
                            enabled: false
                        },
                        tooltip: {
                            headerFormat: '{point.key}<br>',
                            style: {
                                fontSize: '18px'
                            }
                        },
                        series: [
                            {
                                name: '數量',
                                colorByPoint: true,
                                data: result,
                                dataLabels: {
                                    enabled: true,
                                    color: 'black',
                                    align: 'center',
                                    format: '{point.y}', // one decimal
                                    y: 10, // 10 pixels down from the top
                                    style: {
                                        fontSize: '13px'
                                    }
                                }
                            },
                        ],
                    });

                },
                cache: false,
                async: false
            })
        }

        //這禮拜的營業額
        function weekRevenue() {
            $.ajax({
                type: 'GET',
                url: '@Url.Action("getWeekRevenueData", "AdminLTE")',
                success: function (result) {
                    console.log(result.y);
                    var myChart = Highcharts.chart('weekRevenue', {
                        chart: {
                            type: 'spline'
                        },
                        title: {
                            text: `Week of Revenue`
                        },
                        xAxis: {
                            categories: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
                        },
                        yAxis: {
                            min: 0,
                            title: {
                                text: '營業額',
                            },
                            labels: {
                                formatter: function () {
                                    return 'NT$ ' + this.value;
                                }
                            }
                        },
                        legend: {
                            enabled: false
                        },
                        tooltip: {
                            crosshairs: true,
                            shared: true
                        },
                        plotOptions: {
                            spline: {
                                marker: {
                                    radius: 4,
                                    lineColor: '#666666',
                                    lineWidth: 1
                                }
                            }
                        },
                        series: [
                            {
                                name: '營業額',
                                marker: {
                                    symbol: 'square'
                                },
                                data: result.y,
                            },
                        ],
                    });

                },
                cache: false,
                async: false
            })
        }
    </script>
}
