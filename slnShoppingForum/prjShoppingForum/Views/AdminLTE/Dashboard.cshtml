
@{
    ViewBag.Title = "Dashboard";
}

<h2>儀錶板</h2>

<iframe width="960px" height="596px" src="https://app.powerbi.com/reportEmbed?reportId=dd5ee668-54a4-4b26-8d79-0b05800850fe&autoAuth=true&ctid=fbf0cb04-6e6a-4334-9e1d-38fd37234fdb&config=eyJjbHVzdGVyVXJsIjoiaHR0cHM6Ly93YWJpLXNvdXRoLWVhc3QtYXNpYS1yZWRpcmVjdC5hbmFseXNpcy53aW5kb3dzLm5ldC8ifQ%3D%3D" frameborder="0" allowFullScreen="true"></iframe>

<div style="text-align:center">
    請輸入查詢數量(內建為5) : <input id="topNumber" type="number" min="1" value="5"/>
    <a class="btn btn-outline-info" onclick="topProduct()">查詢</a>
</div>
<div id="topProduct" style="width:100%; height:400px;"></div>
<div id="weekRevenue"></div>



@section scripts{
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script>
        $(document).ready(function () {
            topProduct();
            weekRevenue();
        })

        //銷售數量最多的商品
        function topProduct()
        {
            let topNumber = $("#topNumber").val();

            $.ajax({
                type: 'GET',
                url: "../AdminLTE/getTopProductData?topNumber="+ topNumber,
                success: function (result) {
                    console.log(result);
                    var myChart = Highcharts.chart('topProduct', {
                        chart: {
                            type: 'column'
                        },
                        title: {
                            text: `Top ${topNumber}`
                        },
                        xAxis: {
                            type: 'category',
                            labels: {
                                style: {
                                    fontSize: '18px'
                                }
                            }
                        },
                        yAxis: {
                            min:0,
                            title: {
                                text: '數量',
                            },
                        },
                        legend: {
                            enabled: false
                        },
                        tooltip: {
                            headerFormat: '{point.key}<br>',
                            style: {
                                fontSize: '18px'
                            }
                        },
                        series: [
                            {
                                name: '數量',
                                colorByPoint: true,
                                data: result,
                                dataLabels: {
                                    enabled: true,
                                    color: 'black',
                                    align: 'center',
                                    format: '{point.y}', // one decimal
                                    y: 10, // 10 pixels down from the top
                                    style: {
                                        fontSize: '13px'
                                    }
                                }
                            },
                        ],
                    });

                },
                cache: false,
                async: false
            })
        }

        //這禮拜的營業額
        function weekRevenue() {
            $.ajax({
                type: 'GET',
                url: '@Url.Action("getWeekRevenueData", "AdminLTE")',
                success: function (result) {
                    console.log(result.y);
                    var myChart = Highcharts.chart('weekRevenue', {
                        chart: {
                            type: 'spline'
                        },
                        title: {
                            text: `Week of Revenue`
                        },
                        xAxis: {
                            categories: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
                        },
                        yAxis: {
                            min: 0,
                            title: {
                                text: '營業額',
                            },
                            labels: {
                                formatter: function () {
                                    return 'NT$ ' + this.value;
                                }
                            }
                        },
                        legend: {
                            enabled: false
                        },
                        tooltip: {
                            crosshairs: true,
                            shared: true
                        },
                        plotOptions: {
                            spline: {
                                marker: {
                                    radius: 4,
                                    lineColor: '#666666',
                                    lineWidth: 1
                                }
                            }
                        },
                        series: [
                            {
                                name: '營業額',
                                marker: {
                                    symbol: 'square'
                                },
                                data: result.y,
                            },
                        ],
                    });

                },
                cache: false,
                async: false
            })
        }
    </script>
}