@model prjShoppingForum.Models.Entity.tProduct

@{
    ViewBag.Title = "ProductSinglePage";
}

<div class="container">
    <div class="row">
        <div class="col-12 col-md-4 col-lg-3">
            <div class="shop_sidebar_area">
                <div class="widget catagory mb-50">

                    @*導入商品分類目錄*@
                    @Html.Partial("_Product_Menu", (tw.com.essentialoil.Product.ViewModels.ProductMenu)ViewBag.productMenu)

                    @Html.ActionLink("進階搜尋", "AdvanceQueryPage")
                </div>
            </div>
        </div>



        <div class="col-12 col-md-8 col-lg-9">
            <div>
                <dl class="dl-horizontal">

                    @{
                        var imageScr = $"../../images/Product/{Model.fProductID}.jpg";
                    }
                    <img src="@imageScr" style="width:30%" />
                    <dt>
                        @Html.DisplayNameFor(model => model.fProductChName)
                    </dt>

                    <dd>
                        @Html.DisplayFor(model => model.fProductChName)
                    </dd>

                    <dt>
                        @Html.DisplayNameFor(model => model.fProductDesc)
                    </dt>

                    <dd>
                        @Html.DisplayFor(model => model.fProductDesc)
                    </dd>

                    <dt>
                        @Html.DisplayNameFor(model => model.fUnitPrice)
                    </dt>

                    <dd>
                        @Html.DisplayFor(model => model.fUnitPrice)
                    </dd>

                    <dt>
                        @Html.DisplayNameFor(model => model.fQuantityPerUnit)
                    </dt>

                    <dd>
                        @Html.DisplayFor(model => model.fQuantityPerUnit)
                    </dd>

                    @*<dt>
                            @Html.DisplayNameFor(model => model.fDiscontinued)
                        </dt>

                        <dd>
                            @Html.DisplayFor(model => model.fDiscontinued)
                        </dd>*@

                    <dt>
                        @Html.DisplayNameFor(model => model.tCategory.fCategoryName)
                    </dt>

                    <dd>
                        @Html.DisplayFor(model => model.tCategory.fCategoryName)
                    </dd>

                    <dt>
                        @Html.DisplayNameFor(model => model.tProductUnilateral.fOrigin)
                    </dt>

                    <dd>
                        @Html.DisplayFor(model => model.tProductUnilateral.fOrigin)
                    </dd>


                    <dd>
                        購買數量
                        <input type="number" id="buyQuantity" max="@Model.fUnitsInStock" min="1" value="1" />
                        <input type="hidden" class="txtStock" value="@Model.fUnitsInStock" />
                    </dd>
                    <a class="btn btn-info" onclick="addToFavorite(@Model.fProductID)">收藏</a>
                    <a class="btn btn-warning addCart" onclick="addToCartFromProduct(@Model.fProductID)"><img src="~/Images/ShoppingCart/carticon.png" /></a>

                </dl>
            </div>

            @section scripts{
                <script src="~/Scripts/ShoppingCart/jquery.fly.min.js"></script>
                <script>

    //當數量欄位被鍵盤修改時
    $("#buyQuantity").change(function () {
        if (parseInt($(this).val()) > 0 && parseInt($(this).val()) <= parseInt($(this).siblings(".txtStock").val())) {
            $(this).val()
        }
        else {
            $(this).val(1)                                                                  //如果值不屬於範圍區間，則返回1
        }
    })
    //Ajax : 加入收藏清單
    function addToFavorite(productId) {
        $.ajax({
            type: 'POST',
            url:'@Url.Action("CreatFromProduct", "ProductFavorite")',
            data: { productId : productId}
        })
    }
    //Ajax:加入購物車
    function addToCartFromProduct(productId) {
        let selectQuantity = parseInt($("#buyQuantity").val());

        $.ajax({
            type: 'POST',
            url:'@Url.Action("addToCartfromProduct", "ShoppingCart")',
            data: { productId: productId, selectQuantity: selectQuantity },
            async: false
        })
    }

    //加入購物車動畫
    $(".addCart").click(function (event) {
        var addcar = $(this);
        var img = addcar.find('img').attr('src');
        var flyer = $('<img class="u-flyer" src="' + img + '">');
        flyer.fly({
            start: {
                left: event.pageX,
                top: event.pageY - $(window).scrollTop()
            },
            end: {
                left: $("#essenceCartBtn").offset().left, //結束位置（必填）
                top: $("#essenceCartBtn").offset().top - $(window).scrollTop(), //結束位置（必填）
                width: 0, //結束時寬度
                height: 0 //結束時高度
            },
            onEnd: function () { //結束回撥
                addcar.css("cursor", "default");
            }
        });
    })
                </script>
            }
        </div>
    </div>
</div>
          