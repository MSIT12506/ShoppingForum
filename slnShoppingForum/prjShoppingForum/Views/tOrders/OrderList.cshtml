@model tw.com.essentialoil.ViewModels.COrderViews
@{
    decimal discount = 0;
    if (Model.Order.FirstOrDefault().fDiscountCode != null && Model.Order.FirstOrDefault().fDiscountCode != "無")
    {
        discount = Model.DiscountContent;
    }
    var total = 0;
    var disc = 0;
}


@section styles{
    <style>
        .hide {
            display: none;
        }

        .container {
            margin-top: 20px;
        }

        tr.active {
            background: lightblue;
        }

        .productSum {
            color: red
        }

        .numberPlus {
            height: 40px;
            width: 40px;
        }

        .numberMinus {
            height: 40px;
            width: 40px;
        }

        /*取消input[type=number]箭頭格式*/
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
        }

        input[type="number"] {
            -moz-appearance: textfield;
        }

        .checkbox {
            height: 15px !important;
            width: 15px !important;
        }

        .form-row {
            text-align: left;
        }
    </style>
}

<div style="width:70%;text-align:left;margin:auto;padding-top:0px;">
    <div style="margin-top:150px;margin-bottom:10px">
        <img src="~/Images/ShoppingCart/CompleteOrder.png" style="height:100px;width:320px; margin-right:60px" />
        <img src="~/Images/ShoppingCart/step3.png" style="height:150px;width:auto;" />
    </div>
</div>

<div class="container" style="width:70%;text-align:left;margin:auto;padding-top:5px;padding-bottom:10px;font-size:18px;">
    @*<div class="wrappers">*@
    @*<form action="~/tOrders/OrderCreate" method="post" id="wizard" name="OrderForm">*@
    <h3 style="margin-top:20px">已經確認收到您的訂單，我們將為您安排出貨</h3>
    <div style="text-align:left;border-top:1px dashed black;padding:30px;">
        <h2>訂購明細</h2>
        @foreach (var list in Model.Order)
        {
            var shipdate = "";
            var requiredate = "";
            if (list.fShippedDate != null)
            {
                shipdate = ((DateTime)list.fShippedDate).ToString("yyyy/MM/dd");
            }            
            if (list.fRequiredDate != null)
            {
                requiredate = ((DateTime)list.fRequiredDate).ToString("yyyy/MM/dd");
            }
            int subtotal = 0;
            var orderid = list.fOrderDate.ToString("yyyyMMdd") + list.fOrderId;
            foreach (var q in Model.OrderDetail.Where(p => p.fOrderId == list.fOrderId))
            {
                var littlesubtotal = Convert.ToInt32(q.fUnitPrice * q.fOrderQuantity);
                subtotal += littlesubtotal;
            }
            if (discount != 0)
            {
                if (discount > 1)
                {
                    total = subtotal - (int)discount;
                    disc = subtotal - total;
                }
                else
                {
                    total = subtotal * (int)(discount * 100) / 100;
                    disc = subtotal - total;
                }
            }
            else
            {
                total = subtotal - Convert.ToInt32(Model.Order.FirstOrDefault().fScore);
                disc = Convert.ToInt32(Model.Order.FirstOrDefault().fScore);
            }
            <div class="row" style="margin-top:20px">
                <div class="col-6" id="card-362120">
                    <b style="font-weight:bold">訂單編號:</b> <a class="card-link collapsed" style="font-size:18px">@orderid</a>
                </div>
                <div class="col-6">
                    <b style="font-weight:bold">預計送達日: @shipdate</b>
                </div>
            </div>
            <div class="row" style="margin-top:20px">
                <div class="col-6">
                    訂單日期: @list.fOrderDate
                </div>
                <div class="col-6">
                    希望送達日: @requiredate
                </div>
            </div>
            <div class="row" style="margin-top:20px">
                <div class="col-6">
                    收貨人姓名: @list.fConsigneeName
                </div>
                <div class="col-6">
                    收貨人電話: @list.fConsigneeCellPhone
                </div>
            </div>
            <div class="row" style="margin-top:20px">
                <div class="col-6">
                    收貨人地址: @list.fConsigneeAddress
                </div>
                <div class="col-6">
                    發票公司抬頭: @list.fOrderCompanyTitle
                </div>
            </div>
            <div class="row" style="margin-top:20px">
                <div class="col-6">
                    統一編號: @list.fOrderTaxIdDNumber
                </div>
                <div class="col-6">
                    訂單備註: @list.fOrderPostScript
                </div>
            </div>
            <div class="row" style="margin-top:20px">
                <div class="col-6">
                    支付方式: @list.fPayment
                </div>
                <div class="col-6">
                    <b style="font-weight:bold">小計:</b><b style="color:red"> NT$ @subtotal</b>
                </div>
            </div>
            <div class="row" style="margin-top:20px">
                <div class="col-6">
                    <b style="font-weight:bold">折扣優惠:</b><b style="color:red"> NT$ @disc</b>
                </div>
                <div class="col-6">
                    <b style="font-weight:bold">總計:</b><b style="color:red"> NT$ @total</b>
                </div>
            </div>
        }
    </div>
    @*<div id="card-element-608462" class="table table-info collapse">*@
    <div style="text-align:center;border-top:1px dashed black;padding:30px;text-align:center">
        <h2>購買商品清單</h2>
        <table class="table table-secondary" style="font-size:14px">
            <thead class="thead-light">
                <tr>
                    <th>
                        <b>圖片</b>
                    </th>
                    <th>
                        <b>商品名稱</b>
                    </th>
                    <th>
                        <b>單價</b>
                    </th>
                    <th>
                        <b>數量</b>
                    </th>
                    <th>
                        <b style="font-weight:bold">小計</b>
                    </th>
                    @*<th>
            <b>小計</b>
        </th>*@
                </tr>
                @foreach (var list1 in Model.Order)
                {
                    foreach (var orderdetial in Model.OrderDetail.Where(p => p.fOrderId == list1.fOrderId))
                    {
                        var price = orderdetial.fUnitPrice * orderdetial.fOrderQuantity;
                        var imageScr = $"/Images/Product/ura/{orderdetial.fProductId}.jpg";
                        var pdhref = $"/ProductFront/ProductSinglePage?productId={orderdetial.fProductId}";
                        var productname = orderdetial.tProduct.fProductChName;//Model.Product.Where(p => p.fProductID == orderdetial.fProductId).FirstOrDefault();
                        <tr>
                            <td>
                                <a href="@pdhref"><img src="@imageScr" style="height:30px;width:30px" /></a>
                            </td>
                            <td>
                                <a href="@pdhref" style="color:royalblue;font-size:16px;">@productname</a>
                            </td>
                            <td>
                                NT$ @orderdetial.fUnitPrice
                            </td>
                            <td>
                                @orderdetial.fOrderQuantity
                            </td>
                            <td>
                                <b> NT$ @price</b>
                            </td>
                        </tr>
                        @*<div class="form-row">
                                <div class="form-holder">
                                    商品: <img src="@imageScr" style="height:50px;width:50px" />
                                </div>
                                <div class="form-holder">
                                    商品名稱: @productname.fProductChName
                                </div>
                                <div class="form-holder">
                                    商品價格: @price
                                </div>
                                <div class="form-holder">
                                    商品數量: @orderdetial.fOrderQuantity
                                </div>
                            </div>*@
                    }
                }
                @*</div>*@
                @*</form>*@
                @*</div>*@
        </table>
    </div>
    <div style="margin:40px 0 20px; text-align:center">
        @Html.ActionLink("會員中心", "MemberCenter", "FrontUserProfile", null, new { @class = "btn btn-info", style = "font-size:24px;width:180px" })
        @Html.ActionLink("回到首頁", "Index", "Home", null, new { @class = "btn btn-info", style = "font-size:24px;width:180px" })
    </div>
</div>

<link rel="stylesheet" href="~/Content/styles.css">
<link href="~/Content/themes/base/jquery-ui.min.css" rel="stylesheet" />

@section Scripts{
    <script src="~/Scripts/jquery-3.4.1.min.js"></script>
    <script src="~/Scripts/mains.js"></script>
    <script src="~/Scripts/jquery-ui-1.12.1.min.js"></script>
    <script src="~/Scripts/zh-tw.js"></script>
    <script>
        $(function () {
            alert("恭喜完成訂購！");
        });
    </script>
}
